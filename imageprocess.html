<html>
<head>
<!-- Use this to create a form where we can do something with the input-->
<!-- IF CLOUDINARY LINK IS BROKEN, SEE BLOG POST HERE
http://cloudinary.com/blog/direct_upload_made_easy_from_browser_or_mobile_app_to_the_cloudbin -->
	<script src='node_modules/jquery/dist/jquery.js' type='text/javascript'></script>
	<script src='bower_components/jquery/dist/jquery.min.js' type='text/javascript'></script>
	<script src='cloudinary_js/js/jquery.ui.widget.js' type='text/javascript'></script>
	<script src='cloudinary_js/js/jquery.iframe.transport.js' type='text/javascript'></script>
	<script src='cloudinary_js/js/jquery.fileupload.js' type='text/javascript'></script>
	<script src='cloudinary_js/js/jquery.cloudinary.js' type='text/javascript'></script>
	<script src='node_modules/d3/build/d3.js'></script>
	<link rel = "stylesheet" type= "text/css" href = "styles.css"></link>
	<script>
	$.cloudinary.config({ cloud_name: 'boardgameanywhere', api_key: '797866663199626'})
	</script>
</head>
<body>




	<div class = "upload_form">Save File to Cloud </div>

	<script>
	$('.upload_form').append($.cloudinary.unsigned_upload_tag("p76riotl", 
  		 {cloud_name: 'boardgameanywhere' }));
		 $('.upload_form').unsigned_cloudinary_upload("zcudy0uz", 
		  { cloud_name: 'demo', tags: 'browser_uploads' }, 
		  { multiple: true }
		).bind('cloudinarydone', function(e, cddata) {

		  console.log(cddata.result.url) 
		  $.ajax({
		  	method:'POST',
		  	url:'https://api.ocr.space/Parse/Image',
		  	data:{'apikey':'f19b20c27688957','language':'eng','url':cddata.result.url},
		  	success: function(data){
		  		console.log(data.ParsedResults);
		  		console.log('typeof',typeof data.ParsedResults[0].ParsedText);
		  		console.log(data.ParsedResults[0].ParsedText);
		  	},
		  	failure: function(data){
		  		console.log('error');
		  	}
		  })
		
		}
		)
	</script>


	<form method = 'POST' action = 'https://api.ocr.space/Parse/Image'>
		<input name = 'apikey' value = 'f19b20c27688957' hidden></input>
		<input name = 'language' value = 'eng' hidden></input>
		<input name='url' value='http://www.timberdoodle.com/v/vspfiles/photos/237-237-2.jpg' hidden>
		<input type='submit'>Submit to OCR</input>
	</form>
	<div padding = "20px"  >
		<svg id = "gameboard" width = 1000 height = 500 style = "border:5px solid black">
		</svg>	
	</div>
	<button onclick = "nextletter()">Get next letter</button>
	<script>
	//append unused letters 
	var teststring = "HELLO".split("")
	teststring = teststring.map(function(letter,index){return {letter:letter,y:50,x:(32*index) + 20,offset:10}})
	// unusedletters.forEach(function(letter){
	// 	$('#unusedpile').append($('<span margin-right:"10px">'+ letter + '</span>'))
	// });
	
	var unusedletters = ['a','e','i','o','u']
	function nextletter(){

	}
	//string of words user is already using

	d3.select('svg').selectAll('rect').data(teststring).enter().append('g').append('rect').attr('height',32).attr('width',32).attr('x',function(d){return d.x -2 }).attr('y',function(d){return d.y -28}).attr('fill','rgb(250,208,170)').attr('stroke-width',1).attr('stroke','black').attr('class','draggable').attr('transform','translate(100,0)').attr('class','moveable')

	d3.select('svg').selectAll('text').data(teststring).enter().append('g').append('text').attr('x',function(d){return d.x}).attr('y',function(d){return d.y}).attr('font-size',32).text(function(d){return d.letter}).attr('class','draggable').attr('transform','translate(100,0)').attr('class','moveableletter')

	var tiles = $('.moveable')
	var index = 0;
	var selected = $('.moveable:eq(' + index + ')');
	var selectedletter= $('.moveableletter:eq(' + index + ')');
	selected.attr('stroke','red')
	var translateamount = 2;


	var getnewtranslate = function(old,changex,changey){
		
		var oldx = Number(old.slice(old.indexOf('(') +1,old.indexOf(',')));
		var oldy = Number(old.slice(old.indexOf(',') + 1,old.indexOf(')')));
		//console.log(oldy)
		//var newtrans = old.slice(old.indexOf('(') + 1).slice(0,-1)
		var final = 'translate(' + (oldx + changex) + ',' + (oldy + changey) + ')';
		//console.log(oldy)
;		//console.log(final);
		return final;
	}

	$('body').keydown(function(evt){
		console.log('which',evt.which)
		if(evt.which === 65){
			index ++;
			//change tile
			selected.attr('stroke','black')
			selected = $('.moveable:eq(' + index + ')')
			selected.attr('stroke','red')
			//change letter
			selectedletter = $('.moveableletter:eq(' + index + ')')
		}
		if(evt.which===39){
			selected.attr('transform',getnewtranslate(selected.attr('transform'),translateamount,0))
			selectedletter.attr('transform',getnewtranslate(selectedletter.attr('transform'),translateamount,0))
		} else if(evt.which === 37){
			selected.attr('transform',getnewtranslate(selected.attr('transform'),-translateamount,0))
			selectedletter.attr('transform',getnewtranslate(selectedletter.attr('transform'),-translateamount,0))
		} else if(evt.which === 40){
			selected.attr('transform',getnewtranslate(selected.attr('transform'),0,translateamount))
			selectedletter.attr('transform',getnewtranslate(selectedletter.attr('transform'),0,translateamount))
		} else if(evt.which === 38){
			selected.attr('transform',getnewtranslate(selected.attr('transform'),0,-translateamount))
			selectedletter.attr('transform',getnewtranslate(selectedletter.attr('transform'),0,-translateamount))
		}
	})	

	</script>
	
</body>
</html>